<?xml version="1.0"?>
<!-- 

  
-->
<system name="NoseWheelSteering">

  <property>gear/steering</property>
  <property>gear/nose-wheel-steering</property>

  <channel name="Steering">

          
  <!-- Calculation of castered section -->

    <switch name="fcs/steering/speed-not-zero">
      <default value="1"/>
      <test value="0">
        gear/unit[0]/wheel-speed-fps LE 0.1
      </test>
    </switch>

    <scheduled_gain>
      <input>-fcs/steering/angular-vel-degsec</input>
        <table>
          <independentVar> gear/unit[0]/wheel-speed-fps </independentVar>
          <tableData>
             0           10000
             2           15000
            10            5000
          </tableData>
        </table>
      <!-- <gain>fcs/steering/speed-not-zero</gain> -->
      <output>fcs/steering/damping-force</output>
    </scheduled_gain>

    <fcs_function name="fcs/steering/torque-tyre-side-lbsft">
      <function>
        <sum>
          <product>
            <property>gear/unit[0]/side_friction_coeff</property> <!-- Computing real force generated by tyre -->
            <property>gear/unit[0]/compression-ft</property>
            <property>gear/unit[0]/static_friction_coeff</property> <!-- This propety will need to be deleted when JSBSim will sync with FG after 10th November -->
            <value>6600</value> <!-- 15000 lbs/ft (spring stiffness) * 1.666 (1/0.6 static friction, needs to be deleted see above) * 0.264 (arm in feets from axis of rotation to the contact point) -->
            <property>fcs/steering/speed-not-zero</property>
          </product>
          <property>fcs/steering/damping-force</property>
          <property>fcs/steering/centering-torque</property>
        </sum>
      </function>
      <clipto>
        <min>-10000</min>
        <max>10000</max>
      </clipto>
    </fcs_function>

    <fcs_function name="fcs/steering/angular-accel-radsec2">
      <function>
        <quotient>
          <property>fcs/steering/torque-tyre-side-lbsft</property>
          <value>10000</value> <!-- moment of inertia in z axis for NOSE strut-->
        </quotient>
      </function>
    </fcs_function>

    <fcs_function name="fcs/steering/angular-vel-degsec">
      <function>
        <sum>
          <product>
            <property>fcs/steering/angular-accel-radsec2</property>
            <value>0.47746482908</value> <!-- simrate * radtodeg-->
          </product>
          <property>fcs/steering/angular-vel-degsec</property>
        </sum>
      </function>
      <clipto>
        <min>-45</min>
        <max>45</max>
      </clipto>
    </fcs_function>

    <summer name="fcs/steering/steer-cmd-deg-castered">
      <input>fcs/steering/steer-pos-deg</input>
      <input>fcs/steering/angular-vel-degsec</input>
      <clipto>
        <min>-45</min>
        <max>45</max>
      </clipto>
    </summer>

    <pure_gain name="fcs/steering/steer-cmd-norm-castered">
      <input>fcs/steering/steer-cmd-deg-castered</input>
      <gain>0.0222222222</gain>
    </pure_gain>

  <!-- Calculation of steerable section -->
         
    <scheduled_gain name="fcs/steering/steer-cmd-norm">
      <input>fcs/steer-cmd-norm</input>
      <table>
        <independentVar> gear/steering </independentVar>
        <tableData>
          10            0.2222222
          45            1.0
        </tableData>
      </table>
    </scheduled_gain>     

    <switch name="fcs/steering/steer-cmd-norm-overall">
      <default value="fcs/steering/steer-cmd-norm-final"/>
      <test value="fcs/steering/steer-cmd-norm">
        gear/nose-wheel-steering == 1
        gear/unit[0]/WOW == 1
      </test>
    </switch>

    <kinematic name="fcs/steering/steer-cmd-norm-switched-kinematic">
      <input>fcs/steering/steer-cmd-norm-overall</input>
        <traverse>
          <setting>
            <position>-1</position>
            <time>0</time>
          </setting>
          <setting>
            <position>1</position>
            <time>8</time>
          </setting>
        </traverse>
    </kinematic>
	  
  <!-- Calculation of summed deflection -->

    <switch name="fcs/steering/steer-cmd-norm-final">
      <default value="fcs/steering/steer-cmd-norm-castered"/>
      <test value="fcs/steering/steer-cmd-norm-switched-kinematic">
        gear/nose-wheel-steering == 1
        gear/unit[0]/WOW == 1
      </test>
    </switch>

    <pure_gain name="fcs/steering/steer-pos-deg">
      <input>fcs/steering/steer-cmd-norm-final</input>
      <gain>45</gain>
      <output>fcs/steer-pos-deg</output>
    </pure_gain>

  <!-- Calculation for future computations -->

    <fcs_function name="fcs/steering/centering-torque">
      <function>
        <product>
          <table>
            <independentVar>fcs/steering/steer-pos-deg</independentVar>
            <tableData>
             -25        0
             -22.5      0.08
             -20        0.12
             -17.5      0.2
             -15        0.31
             -12.5      0.38
             -10        0.42
             -7.5       0.55
             -5         0.6
             -2.5       0.77
             0          0
             2.5        -0.77
             5          -0.6
             7.5        -0.55
             10         -0.42
             12.5       -0.38
             15         -0.31
             17.5       -0.2
             20         -0.12
             22.5       -0.08
             25         0    
            </tableData>
          </table>
          <value>100</value>
          <property>fcs/steering/speed-not-zero</property>
        </product>
      </function>
    </fcs_function>

  </channel>

</system>
