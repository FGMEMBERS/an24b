<?xml version="1.0"?>
<!-- 

  
-->
<system name="NoseWheelSteering">

  <property>gear/steering</property>
  <property>gear/nose-wheel-steering</property>

  <channel name="Steering">

  <!-- Calculation of castered section -->

    <pure_gain name="fcs/steering/speed-sensitive-centering">
      <input>velocities/vg-fps</input>
      <gain>0.1176</gain>
      <clipto>
        <min>0</min>
        <max>1</max>
      </clipto>
    </pure_gain>

    <pure_gain name="fcs/steering/slip-error-deg">
      <input>gear/unit[0]/slip-angle-deg</input>
      <gain>0.1</gain>
    </pure_gain>

    <fcs_function name="fcs/steering/center-error-deg">
      <function>
        <product>
          <property>fcs/steering/steer-now-pos-deg</property>
          <property>fcs/steering/speed-sensitive-centering</property>
          <value>-0.03</value>
        </product>
      </function>
    </fcs_function>

    <summer name="fcs/steering/steer-cmd-castered-deg">
      <input>fcs/steering/steer-now-pos-deg</input> <!-- fcs/steering/steer-now-pos-deg -->
      <input>fcs/steering/slip-error-deg</input>
      <input>fcs/steering/center-error-deg</input>
      <clipto>
        <min>-45</min>
        <max>45</max>
      </clipto>
      <output>fcs/steering/steer-cmd-castered-sum-deg</output>
    </summer>

    <pure_gain name="fcs/steering/steer-cmd-castered-sum-norm">
      <input>fcs/steering/steer-cmd-castered-sum-deg</input>
      <gain>0.0222222222222</gain>
    </pure_gain>

    <kinematic>
      <input>fcs/steering/steer-cmd-castered-sum-norm</input>
        <traverse>
          <setting>
            <position>-1</position>
            <time>0</time>
          </setting>
          <setting>
            <position>1</position>
            <time>4</time>
          </setting>
        </traverse>
      <output>fcs/steering/steer-cmd-castered-sum-norm-kinematic</output>
    </kinematic>
   
  <!-- Calculation of steerable section -->

    <scheduled_gain name="fcs/steer-cmd-norm-switched">
      <input>fcs/steer-cmd-norm</input>
        <table>
           <independentVar> gear/steering </independentVar>
             <tableData>
                10            0.22222
                45            1.0
             </tableData>
           </table>
    </scheduled_gain>

    <fcs_function name="fcs/steering/steer-cmd-norm-switched-overall">
      <function>
        <sum>
          <product>
            <property>fcs/steer-cmd-norm-switched</property>
            <property>gear/nose-wheel-steering</property>
          </product>
          <product>
            <property>fcs/steering/steer-now-pos-deg</property>
            <value>0.22222</value>
            <sum>
              <product>
                <property>gear/nose-wheel-steering</property>
                <value>-1</value>
              </product>
              <value>1</value>
            </sum>
          </product>
        </sum>
      </function>
    </fcs_function>

    <kinematic>
      <input>fcs/steering/steer-cmd-norm-switched-overall</input>
        <traverse>
          <setting>
            <position>-1</position>
            <time>0</time>
          </setting>
          <setting>
            <position>1</position>
            <time>8</time>
          </setting>
        </traverse>
      <output>fcs/steer-cmd-norm-kinematic</output>
    </kinematic>

  <!-- Calculation of summed deflection -->

    <fcs_function>
      <function>
        <sum>
          <product>
            <property>fcs/steer-cmd-norm-kinematic</property>
            <property>gear/nose-wheel-steering</property>
          </product>
          <product>
            <property>fcs/steering/steer-cmd-castered-sum-norm-kinematic</property>
            <sum>
              <product>
                <property>gear/nose-wheel-steering</property>
                <value>-1</value>
              </product>
              <value>1</value>
            </sum>
          </product>
        </sum>
      </function>
      <output>fcs/steer-cmd-norm-final</output>
    </fcs_function>

    <pure_gain>
      <input>fcs/steer-cmd-norm-final</input>
      <gain>45</gain>
      <output>fcs/steer-pos-deg</output>
    </pure_gain>

  <!-- Calculation of final position of nosegear for future calculations -->

    <fcs_function name="fcs/steering/steer-now-pos-deg">
      <function>
        <sum>
          <product>
            <property>fcs/steer-pos-deg</property>
            <property>gear/nose-wheel-steering</property>
          </product>
          <product>
            <property>fcs/steering/steer-cmd-castered-sum-norm-kinematic</property>
            <value>45</value>
            <sum>
              <product>
                <property>gear/nose-wheel-steering</property>
                <value>-1</value>
              </product>
              <value>1</value>
            </sum>
          </product>
        </sum>
      </function>
    </fcs_function>

  </channel>

</system>
